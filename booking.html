<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book a Tailor – TailorLink🔗</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />

    <style>
      /* style.css */

/* --- Root Variables --- */
:root {
  --primary-color: #17911d; /* Green */
  --primary-light: #27ae60;
  --primary-dark: #0f6e16;
  --accent-color: #007bff; /* Blue for highlights if needed */
  --background-color: #f0f2f5; /* Light subtle background */
  --card-background: #ffffff;
  --text-color: #333; /* Dark grey for general text */
  --text-muted: #666; /* Lighter grey for secondary text */
  --border-color: #e0e0e0;
  --input-border-color: #ccc;
  --focus-border-color: var(--primary-color);
  --error-color: #e74c3c; /* Red for errors */
  --success-color: #28a745; /* Green for success */

  --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.08);
  --shadow-medium: 0 5px 15px rgba(0, 0, 0, 0.1);
  --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.15);

  --border-radius-small: 4px;
  --border-radius-medium: 8px;
  --border-radius-large: 12px;
}

/* --- Dark Mode Variables (Optional, for toggleDarkMode functionality) --- */
body.dark-mode {
  --background-color: #2c2c2c;
  --card-background: #3a3a3a;
  --text-color: #f5f5f5;
  --text-muted: #bbb;
  --border-color: #555;
  --input-border-color: #777;
  --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-medium: 0 5px 15px rgba(0, 0, 0, 0.4);
  --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.5);
}

/* --- Base Styles --- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Inter", sans-serif;
  line-height: 1.6;
  color: var(--text-color);
  background-color: var(--background-color);
  transition: background-color 0.3s ease, color 0.3s ease;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

a {
  color: var(--primary-color);
  text-decoration: none;
  transition: color 0.2s ease;
}

a:hover {
  color: var(--primary-dark);
  text-decoration: underline;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: "Poppins", sans-serif;
  color: var(--text-color);
  margin-bottom: 0.8em;
  font-weight: 700;
}

h2 {
  font-size: 2.2rem;
  text-align: center;
  margin-bottom: 2rem;
}

/* --- Utility Classes --- */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.section {
  padding: 60px 20px;
  flex-grow: 1; /* Allows main content to expand */
}

/* --- Buttons --- */
.btn {
  display: inline-block;
  padding: 12px 25px;
  font-size: 1rem;
  font-weight: 600;
  text-align: center;
  cursor: pointer;
  border: none;
  border-radius: var(--border-radius-medium);
  transition: all 0.3s ease;
}

.btn-primary {
  background-color: var(--primary-color);
  color: white;
}

.btn-primary:hover {
  background-color: var(--primary-dark);
  box-shadow: var(--shadow-hover);
  transform: translateY(-2px);
}

.btn-secondary {
  background-color: transparent;
  color: var(--primary-color);
  border: 2px solid var(--primary-color);
}

.btn-secondary:hover {
  background-color: var(--primary-color);
  color: white;
  box-shadow: var(--shadow-light);
}

.btn-small {
  padding: 8px 15px;
  font-size: 0.9rem;
}

.btn:disabled {
  background-color: #a0a0a0;
  cursor: not-allowed;
  box-shadow: none;
  transform: none;
}

/* --- Navbar --- */
.navbar {
  background-color: var(--card-background);
  box-shadow: var(--shadow-light);
  padding: 15px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap; /* Allows wrapping on smaller screens */
  gap: 15px; /* Space between items if they wrap */
}

.navbar .logo {
  font-family: "Poppins", sans-serif;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--text-color);
}

.navbar .logo span {
  color: var(--primary-color);
}

.navbar .nav-links {
  display: flex;
  align-items: center;
  gap: 20px;
}

.navbar .nav-links a {
  color: var(--text-color);
  font-weight: 500;
  padding: 8px 12px;
  border-radius: var(--border-radius-small);
  transition: background-color 0.2s ease, color 0.2s ease;
}

.navbar .nav-links a:hover,
.navbar .nav-links a.active {
  background-color: rgba(var(--primary-color-rgb, 23, 145, 29), 0.1); /* Use RGB for alpha */
  color: var(--primary-color);
  text-decoration: none;
}

/* Ensure RGB variable is defined for JS manipulation */
body {
  --primary-color-rgb: 23, 145, 29;
}


/* --- Forms --- */
.form-group {
  margin-bottom: 1.5rem;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: var(--text-color);
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="password"],
.form-group input[type="tel"],
.form-group input[type="date"],
.form-group input[type="time"],
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--input-border-color);
  border-radius: var(--border-radius-small);
  font-size: 1rem;
  font-family: "Inter", sans-serif;
  color: var(--text-color);
  background-color: var(--card-background);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  border-color: var(--focus-border-color);
  box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb, 23, 145, 29), 0.2);
  outline: none;
}

.form-group input::placeholder,
.form-group textarea::placeholder {
  color: var(--text-muted);
  opacity: 0.7;
}

.form-group.error input,
.form-group.error select,
.form-group.error textarea {
  border-color: var(--error-color);
}

.error-message {
  color: var(--error-color);
  font-size: 0.85rem;
  margin-top: 0.5rem;
  display: block; /* Ensures it takes full width below input */
}

/* --- Messages (Success/Error) --- */
.message {
  padding: 12px 20px;
  margin: 1rem 0;
  border-radius: var(--border-radius-small);
  font-size: 1rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 10px;
}

.message.success {
  background-color: rgba(40, 167, 69, 0.1); /* var(--success-color) with alpha */
  color: var(--success-color);
  border: 1px solid var(--success-color);
}

.message.error {
  background-color: rgba(231, 76, 60, 0.1); /* var(--error-color) with alpha */
  color: var(--error-color);
  border: 1px solid var(--error-color);
}

.message .close-btn {
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: inherit;
  margin-left: auto;
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.message .close-btn:hover {
  opacity: 1;
}


/* --- Loader Overlay --- */
.loader-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
  -webkit-backdrop-filter: blur(5px);
  display: none; /* Hidden by default */
}

.loader {
  border: 6px solid #f3f3f3;
  border-top: 6px solid var(--primary-color);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* --- Footer --- */
.footer {
  background-color: var(--card-background);
  color: var(--text-color);
  padding: 40px 20px;
  box-shadow: var(--shadow-light);
  margin-top: auto; /* Pushes footer to the bottom */
  width: 100%;
}

.footer-content {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  gap: 30px;
  max-width: 1200px;
  margin: 0 auto;
}

.footer-brand,
.footer-links,
.footer-contact {
  flex: 1;
  min-width: 200px;
}

.footer-brand h3,
.footer-links h4,
.footer-contact h4 {
  font-family: "Poppins", sans-serif;
  font-weight: 600;
  margin-bottom: 15px;
  color: var(--primary-color);
}

.footer-brand p {
  font-size: 0.9rem;
  color: var(--text-muted);
}

.footer-links ul {
  list-style: none;
}

.footer-links ul li {
  margin-bottom: 10px;
}

.footer-links ul li a {
  color: var(--text-muted);
  font-size: 0.95rem;
  transition: color 0.2s ease;
}

.footer-links ul li a:hover {
  color: var(--primary-color);
  text-decoration: underline;
}

.footer-contact p {
  font-size: 0.9rem;
  margin-bottom: 5px;
  color: var(--text-muted);
}

.footer-bottom {
  text-align: center;
  margin-top: 30px;
  padding-top: 20px;
  border-top: 1px solid var(--border-color);
  font-size: 0.85rem;
  color: var(--text-muted);
}


/* --- Responsive Adjustments --- */
@media (max-width: 768px) {
  .navbar {
    flex-direction: column;
    align-items: flex-start;
  }
  .navbar .nav-links {
    margin-top: 15px;
    width: 100%;
    justify-content: space-around;
  }
  h2 {
    font-size: 1.8rem;
  }
  .section {
    padding: 40px 15px;
  }
  .footer-content {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .footer-links ul {
    padding: 0;
  }
}

@media (max-width: 480px) {
  .navbar .logo {
    font-size: 1.5rem;
  }
  .navbar .nav-links {
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }
  .btn {
    padding: 10px 20px;
    font-size: 0.9rem;
  }
  .form-group label,
  .form-group input,
  .form-group select,
  .form-group textarea {
    font-size: 0.9rem;
  }
}

/* --- Specific Styles for Booking Page --- */
.booking-section {
  max-width: 700px;
  margin: 40px auto;
  background-color: var(--card-background);
  border-radius: var(--border-radius-large);
  box-shadow: var(--shadow-medium);
  padding: 40px;
}

.booking-form {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.booking-form .btn {
  margin-top: 20px;
  width: auto; /* Adjust button width */
  align-self: center; /* Center the button */
}

/* Hide specific elements if not needed, e.g., if a page is just for form */
.form-group .hidden-field {
  display: none;
}
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  </head>
  <body>
    <div id="loader-overlay" class="loader-overlay">
      <div class="loader"></div>
    </div>

    <header class="navbar">
      <div class="logo">Tailor<span>Link</span></div>
      <nav class="nav-links">
        <a href="index.html" class="nav-home">Home</a>
        <a href="about.html" class="nav-about">About</a>
        <a href="customer-bookings.html" class="nav-view">View Bookings</a>
        <a href="login.html" id="nav-auth-link">Login</a>
        <button id="toggleDarkMode" class="btn btn-small">🌓</button>
      </nav>
    </header>

    <main class="section booking-section">
      <h2>Book an Appointment</h2>
      <div id="message-container"></div>
      <form id="bookingForm" class="booking-form">
        <div class="form-group">
          <label for="customerName">Full Name</label>
          <input
            type="text"
            id="customerName"
            placeholder="Enter your full name"
            required
            readonly
            title="Your name is pre-filled from your account"
          />
        </div>

        <div class="form-group">
          <label for="customerEmail">Email</label>
          <input
            type="email"
            id="customerEmail"
            placeholder="Your email address"
            required
            readonly
            title="Your email is pre-filled from your account"
          />
        </div>

        <div class="form-group">
          <label for="tailorSelect">Select a Tailor</label>
          <select id="tailorSelect" required>
            <option value="">Loading tailors...</option>
          </select>
          <span id="noTailorsMessage" style="color: var(--text-muted); font-size: 0.9rem; margin-top: 5px; display: none;">
            No tailors found yet. Please check back later.
          </span>
        </div>

        <div class="form-group">
          <label for="serviceType">Service Type</label>
          <select id="serviceType" required>
            <option value="">Select a service</option>
            <option value="Custom Outfit">Custom Outfit</option>
            <option value="Fitting">Fitting</option>
            <option value="Repair">Clothing Repair</option>
            <option value="Alteration">Alteration</option>
            <option value="Consultation">Consultation</option>
            </select>
        </div>

        <div class="form-group">
          <label for="preferredDate">Preferred Date</label>
          <input type="date" id="preferredDate" required />
          <span id="dateError" class="error-message"></span>
        </div>

        <div class="form-group">
          <label for="preferredTime">Preferred Time</label>
          <input type="time" id="preferredTime" required />
          <span id="timeError" class="error-message"></span>
        </div>

        <div class="form-group">
          <label for="notes">Additional Notes (Optional)</label>
          <textarea
            id="notes"
            rows="4"
            placeholder="Describe your request or any specific requirements."
          ></textarea>
        </div>

        <button type="submit" class="btn btn-primary" id="submitBookingBtn">
          Submit Booking
        </button>
      </form>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="footer-brand">
          <h3>TailorLink🔗</h3>
          <p>Connecting you with trusted tailors – fast, easy, and local.</p>
        </div>
        <div class="footer-links">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="booking.html">Book Now</a></li>
            <li><a href="view-bookings.html">View Bookings</a></li>
          </ul>
        </div>
        <div class="footer-contact">
          <h4>Contact</h4>
          <p>Email: support@tailorlink.com</p>
          <p>Phone: +234 800 000 0000</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 TailorLink🔗. All rights reserved.</p>
      </div>
    </footer>

    <script>

// --- Firebase Configuration ---
  const firebaseConfig = {
        apiKey: "AIzaSyBVjsT4eVkdZaWaYfkgz_hoK00ZgmLWNR4",
        authDomain: "tailorlink-571d5.firebaseapp.com",
        projectId: "tailorlink-571d5",
        storageBucket: "tailorlink-571d5.appspot.com",
        messagingSenderId: "685008238153",
        appId: "1:685008238153:web:8625d73d9511fde3f2b198",
        measurementId: "G-H9RNR0LLKF",
      };


// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- DOM Elements ---
const loaderOverlay = document.getElementById("loader-overlay");
const navAuthLink = document.getElementById("nav-auth-link");
const bookingForm = document.getElementById("bookingForm");
const customerNameInput = document.getElementById("customerName");
const customerEmailInput = document.getElementById("customerEmail");
const tailorSelect = document.getElementById("tailorSelect");
const noTailorsMessage = document.getElementById("noTailorsMessage");
const serviceTypeSelect = document.getElementById("serviceType");
const preferredDateInput = document.getElementById("preferredDate");
const preferredTimeInput = document.getElementById("preferredTime");
const notesInput = document.getElementById("notes");
const submitBookingBtn = document.getElementById("submitBookingBtn");
const messageContainer = document.getElementById("message-container");

// Error message spans
const dateError = document.getElementById("dateError");
const timeError = document.getElementById("timeError");

// Dark Mode Toggle
const toggleDarkModeBtn = document.getElementById("toggleDarkMode");

// --- Global Variables ---
let currentUser = null;
let currentTailors = []; // To store fetched tailor data

// --- Helper Functions ---
function showLoader() {
  loaderOverlay.style.display = "flex";
}

function hideLoader() {
  loaderOverlay.style.display = "none";
}

function displayMessage(type, message) {
  const messageDiv = document.createElement("div");
  messageDiv.className = `message ${type}`;
  messageDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
        <span>${message}</span>
        <button class="close-btn"><i class="fas fa-times"></i></button>
    `;
  messageContainer.innerHTML = ""; // Clear previous messages
  messageContainer.appendChild(messageDiv);

  messageDiv.querySelector(".close-btn").addEventListener("click", () => {
    messageDiv.remove();
  });

  // Auto-hide success messages after 5 seconds
  if (type === "success") {
    setTimeout(() => {
      messageDiv.remove();
    }, 5000);
  }
}

function validateInput(inputElement, errorMessageElement, message) {
  if (!inputElement.value.trim()) {
    inputElement.closest(".form-group").classList.add("error");
    if (errorMessageElement) errorMessageElement.textContent = message;
    return false;
  }
  inputElement.closest(".form-group").classList.remove("error");
  if (errorMessageElement) errorMessageElement.textContent = "";
  return true;
}

function clearAllErrors() {
  document.querySelectorAll(".form-group.error").forEach((el) => {
    el.classList.remove("error");
  });
  document.querySelectorAll(".error-message").forEach((el) => {
    el.textContent = "";
  });
  messageContainer.innerHTML = "";
}

// --- Dark Mode Logic ---
const enableDarkMode = () => {
  document.body.classList.add('dark-mode');
  localStorage.setItem('theme', 'dark');
  toggleDarkModeBtn.textContent = '☀️'; // Sun icon for light mode
};

const disableDarkMode = () => {
  document.body.classList.remove('dark-mode');
  localStorage.setItem('theme', 'light');
  toggleDarkModeBtn.textContent = '🌓'; // Moon icon for dark mode
};

// Check for saved theme preference on load
if (localStorage.getItem('theme') === 'dark') {
  enableDarkMode();
} else {
  disableDarkMode();
}

toggleDarkModeBtn.addEventListener('click', () => {
  if (document.body.classList.contains('dark-mode')) {
    disableDarkMode();
  } else {
    enableDarkMode();
  }
});


// --- Fetch Tailors for Dropdown ---
async function fetchTailors() {
  tailorSelect.innerHTML = '<option value="">Loading tailors...</option>';
  noTailorsMessage.style.display = 'none';
  showLoader();
  try {
    const tailorsSnapshot = await db
      .collection("tailors")
      .where("isActive", "==", true) // Only show active tailors
      .get();

    currentTailors = []; // Reset
    tailorSelect.innerHTML = '<option value="">Select a tailor</option>'; // Default option

    if (tailorsSnapshot.empty) {
      noTailorsMessage.style.display = 'block';
      displayMessage("error", "No active tailors found at this moment. Please try again later.");
      submitBookingBtn.disabled = true; // Disable booking if no tailors
    } else {
      tailorsSnapshot.forEach((doc) => {
        const tailor = doc.data();
        currentTailors.push({ id: doc.id, ...tailor });
        const option = document.createElement("option");
        option.value = doc.id;
        option.textContent = `${tailor.name} (${tailor.location || 'Unknown location'})`;
        tailorSelect.appendChild(option);
      });
      submitBookingBtn.disabled = false; // Enable if tailors are found
    }
  } catch (error) {
    console.error("Error fetching tailors:", error);
    displayMessage(
      "error",
      "Failed to load tailors. Please refresh the page."
    );
    tailorSelect.innerHTML = '<option value="">Failed to load tailors</option>';
    noTailorsMessage.style.display = 'block';
    noTailorsMessage.textContent = 'Failed to load tailors. Please check your internet connection.';
    submitBookingBtn.disabled = true;
  } finally {
    hideLoader();
  }
}

// --- Authentication State Listener ---
auth.onAuthStateChanged(async (user) => {
  if (user) {
    currentUser = user;
    customerNameInput.value = user.displayName || "N/A";
    customerEmailInput.value = user.email || "N/A";
    navAuthLink.textContent = "Dashboard";
    // Assuming 'dashboard.html' is for customers and 'dashboard-tailors.html' for tailors
    // We need to fetch the user's role to set the correct dashboard link
    try {
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (userDoc.exists) {
            const userData = userDoc.data();
            if (userData.role === 'tailor') {
                navAuthLink.href = 'dashboard-tailors.html';
            } else if (userData.role === 'customer') {
                navAuthLink.href = 'explore.html'; // Or dashboard.html for customers
            } else if (userData.role === 'admin') {
                navAuthLink.href = 'dashboard-admin.html';
            }
        } else {
            // If user doc doesn't exist, something is wrong, redirect
            console.warn("User document not found for authenticated user:", user.uid);
            auth.signOut();
            window.location.href = "login.html";
            return;
        }
    } catch (error) {
        console.error("Error fetching user role:", error);
        // Fallback to generic dashboard or login if role fetch fails
        navAuthLink.href = 'explore.html';
    }


    fetchTailors(); // Fetch tailors once user is authenticated
  } else {
    currentUser = null;
    navAuthLink.textContent = "Login";
    navAuthLink.href = "login.html";
    displayMessage("error", "You must be logged in to book an appointment.");
    bookingForm.style.display = "none"; // Hide form if not logged in
    hideLoader(); // Ensure loader is hidden
  }
});

// --- Form Submission Handler ---
bookingForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  clearAllErrors(); // Clear previous errors

  if (!currentUser) {
    displayMessage("error", "You must be logged in to submit a booking.");
    return;
  }

  // Validate all fields
  let isValid = true;
  isValid = validateInput(customerNameInput, null, "") && isValid; // Readonly, but good practice
  isValid = validateInput(customerEmailInput, null, "") && isValid; // Readonly, but good practice
  isValid = validateInput(tailorSelect, null, "Please select a tailor.") && isValid;
  isValid = validateInput(serviceTypeSelect, null, "Please select a service type.") && isValid;
  isValid = validateInput(preferredDateInput, dateError, "Preferred date is required.") && isValid;
  isValid = validateInput(preferredTimeInput, timeError, "Preferred time is required.") && isValid;

  // Date validation: Must not be in the past
  const selectedDate = new Date(preferredDateInput.value);
  const today = new Date();
  today.setHours(0, 0, 0, 0); // Normalize today's date to start of day

  if (selectedDate < today) {
    preferredDateInput.closest(".form-group").classList.add("error");
    dateError.textContent = "Cannot select a date in the past.";
    isValid = false;
  }

  // Time validation (optional but good for business hours)
  // For example, disallow before 9 AM and after 5 PM
  const selectedTime = preferredTimeInput.value; // "HH:MM" format
  const [hours, minutes] = selectedTime.split(':').map(Number);
  if (hours < 9 || hours > 17) { // Assuming business hours are 9 AM to 5 PM
      preferredTimeInput.closest(".form-group").classList.add("error");
      timeError.textContent = "Please select a time between 9 AM and 5 PM.";
      isValid = false;
  }


  if (!isValid) {
    displayMessage("error", "Please fill in all required fields and correct the errors.");
    return;
  }

  // Disable button and show loader
  submitBookingBtn.textContent = "Submitting...";
  submitBookingBtn.disabled = true;
  showLoader();

  const selectedTailorId = tailorSelect.value;
  const selectedTailor = currentTailors.find(t => t.id === selectedTailorId);

  if (!selectedTailor) {
      displayMessage("error", "Selected tailor not found. Please try again.");
      submitBookingBtn.textContent = "Submit Booking";
      submitBookingBtn.disabled = false;
      hideLoader();
      return;
  }

  try {
    const bookingData = {
      customerId: currentUser.uid,
      customerName: currentUser.displayName,
      customerEmail: currentUser.email,
      tailorId: selectedTailorId,
      tailorName: selectedTailor.name,
      serviceType: serviceTypeSelect.value,
      preferredDate: preferredDateInput.value, // Store as YYYY-MM-DD string
      preferredTime: preferredTimeInput.value, // Store as HH:MM string
      notes: notesInput.value.trim(),
      status: "pending", // e.g., 'pending', 'confirmed', 'completed', 'cancelled'
      createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    };

    await db.collection("bookings").add(bookingData);

    displayMessage("success", "Your booking has been submitted successfully!");
    bookingForm.reset(); // Clear form fields
    fetchTailors(); // Re-fetch tailors in case of changes
  } catch (error) {
    console.error("Error submitting booking:", error);
    displayMessage("error", "Failed to submit booking. Please try again.");
  } finally {
    submitBookingBtn.textContent = "Submit Booking";
    submitBookingBtn.disabled = false;
    hideLoader();
  }
});

// --- Initial Page Load Actions ---
document.addEventListener("DOMContentLoaded", () => {
  // Set minimum date for preferredDate input to today
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, "0"); // Months are 0-indexed
  const dd = String(today.getDate()).padStart(2, "0");
  preferredDateInput.min = `${yyyy}-${mm}-${dd}`;
});
    </script>
  </body>
</html>